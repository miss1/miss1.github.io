function setBgPic(){$("body").css("background",'url("./img/bg_sunny.png")'),700<documentWidth?($("body").css("background-size","auto "+documentHeight+"px"),$("body").css("background-repeat","repeat")):($("body").css("background-size",documentWidth+"px "+documentHeight+"px"),$("body").css("background-repeat","repeat-y"))}function getUrlParam(e){e=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),e=window.location.search.substr(1).match(e);return null!=e?decodeURI(e[2]):null}documentWidth=window.innerWidth,documentHeight=window.innerHeight,$(document).ready(function(){setBgPic()});
function alertBox(o,n,t){GenerateHtml(o,n),btnOk(t),btnNo()}function GenerateHtml(o,n){var t=(t=(t="")+('<div id="mb_box"></div><div id="mb_con"><span id="mb_tit">'+o+"</span>")+('<div id="mb_content">'+n+"</div>"))+'<div id="mb_btnbox"><input id="mb_btn_ok" type="button" value="确定"/><input id="mb_btn_no" type="button" value="取消"/></div>'+"</div>";$("body").append(t),GenerateCss(),$("#mb_box,#mb_con").fadeIn()}function GenerateCss(){$("#mb_box").css({width:"100%",height:"100%",zIndex:"99999",position:"fixed",filter:"Alpha(opacity=60)",backgroundColor:"black",top:"0",left:"0",opacity:"0.6",display:"none"}),$("#mb_con").css({zIndex:"999999",position:"fixed",display:"none",backgroundColor:"White",borderRadius:"15px"}),$("#mb_tit").css({display:"block",fontSize:"16px",color:"#444",padding:"10px 15px",backgroundColor:"#DDD",borderRadius:"15px 15px 0 0",borderBottom:"3px solid #009BFE",fontWeight:"bold",textAlign:"center"}),$("#mb_content").css({padding:"20px",lineHeight:"20px",borderBottom:"1px dashed #DDD",fontSize:"15px",color:"#444",textAlign:"center"}),$("#mb_btnbox").css({margin:"15px 0 10px 0",textAlign:"center"}),$("#mb_btn_ok,#mb_btn_no").css({width:"85px",height:"30px",color:"white",border:"none"}),$("#mb_btn_ok").css({backgroundColor:"#168bbb"}),$("#mb_btn_no").css({backgroundColor:"gray",marginLeft:"20px"});var o=document.documentElement.clientWidth,n=document.documentElement.clientHeight,t=$("#mb_con").height(),b=(700<o?$("#mb_con").css("width",400):$("#mb_con").css("width",o-100),$("#mb_con").width());$("#mb_con").css({top:(n-t)/2+"px",left:(o-b)/2+"px"})}function btnOk(o){$("#mb_btn_ok").click(function(){$("#mb_box,#mb_con").fadeTo("slow",.01,function(){$("#mb_box,#mb_con").remove()}),"function"==typeof o&&o()})}function btnNo(){$("#mb_btn_no").click(function(){$("#mb_box,#mb_con").fadeTo("slow",.01,function(){$("#mb_box,#mb_con").remove()})})}
var width,height,cellWidth,cellHeight,presentImg,imgOrigArr=[],imgRandArr=[],moveTime=400,imgCells="",lever=3,isInGame=!1,scroe=0,passImg=[],passKnowledge={},s=0;function initGame(e,t){presentImg=e,$("#btn").unbind(),$("#level").unbind(),$("#game_result span").unbind(),lever=3,$("#level").text("level: "+lever+"x"+lever),$("#imgArea").fadeIn(),$("#game_reward").fadeOut(),$("#game_result span").text("show"),s=0,-1!=$.inArray(e,passImg)?($("#gameAnswer").text(passKnowledge[e]),$("#game_result span").css("background","#62baa0"),$("#game_result span").click(function(){0==s?showReward(e):showback()})):$("#game_result span").css("background","#5E5E5E"),isInGame?alertBox("切换图片","游戏正在进行，确定要切换图片重新开始吗？",function(){removeSclection(),changeState(t),imgSplit(e),$("#btn").text("开始"),isInGame=!1,scroe=0,$("#scroe").text("步数：0")}):(null!=t&&(removeSclection(),changeState(t)),imgSplit(e)),bindbtn(),bindlevel()}function bindbtn(){$("#btn").click(function(){$("#imgArea").fadeIn(),$("#game_reward").fadeOut(),isInGame?alertBox("复原游戏","游戏正在进行，确定要复原吗？",function(){imgSplit(presentImg),rebackGame()}):(imgSplit(presentImg),randomArr(),cellOrder(imgRandArr),beginGamePc(),beginGamePhone(),$("#btn").text("复原"),isInGame=!0,scroe=0,$("#scroe").text("步数：0"))})}function bindlevel(){$("#level").click(function(){isInGame?alertBox("重新开始","游戏尚未结束，确定要切换难度重新开始吗？",function(){lever<6?lever+=1:lever=3,imgSplit(presentImg),rebackGame(),$("#level").text("level: "+lever+"x"+lever)}):(lever<6?lever+=1:lever=3,imgSplit(presentImg),$("#level").text("level: "+lever+"x"+lever))})}function rebackGame(){imgCells.unbind("mouseover"),imgCells.unbind("mouseout"),imgCells.unbind("mousedown"),imgCells.off("touchstart"),$("#btn").text("开始"),isInGame=!1,scroe=0,$("#scroe").text("步数：0")}function imgSplit(e){width=$("#imgArea").width(),height=$("#imgArea").height(),cellWidth=width/lever,cellHeight=height/lever,imgOrigArr=[],imgRandArr=[];var t="";$("#imgArea").html("");for(var n=0;n<lever;n++)for(var r=0;r<lever;r++)imgOrigArr.push(n*lever+r),(t=document.createElement("div")).className="imgCell",$(t).css({width:cellWidth-2,height:cellHeight-2,left:r*cellWidth,top:n*cellHeight,background:"url('"+e+"')",backgroundPosition:-r*cellWidth+"px "+-n*cellHeight+"px"}),$("#imgArea").append(t);(imgCells=$(".imgCell")).css("cursor","pointer")}function beginGamePc(){imgCells.bind("mouseover",function(){$(this).addClass("hover")}),imgCells.bind("mouseout",function(){$(this).removeClass("hover")}),imgCells.bind("mousedown",function(e){$(this).css("cursor","move");var t=$(this).index(),n=e.pageX-$(this).offset().left,r=e.pageY-$(this).offset().top;$(document).bind("mousemove",function(e){imgCells.eq(t).css({zIndex:"40",left:e.pageX-n-$("#imgArea").offset().left,top:e.pageY-r-$("#imgArea").offset().top})}),$(document).bind("mouseup",function(e){e=cellChangeIndex(e.pageX-$("#imgArea").offset().left,e.pageY-$("#imgArea").offset().top,t);t==e?cellReturn(t):cellExchange(t,e),$(document).unbind("mousemove").unbind("mouseup")})}),imgCells.bind("mouseup",function(){$(this).css("cursor","pointer")})}function beginGamePhone(){imgCells.on("touchstart",function(e){var t=$(this).index(),n=e.touches[0].pageX-$(this).offset().left,r=e.touches[0].pageY-$(this).offset().top;$(document).on("touchmove",function(e){imgCells.eq(t).css({zIndex:"40",left:e.touches[0].pageX-n-$("#imgArea").offset().left,top:e.touches[0].pageY-r-$("#imgArea").offset().top})}),$(document).on("touchend",function(e){e=cellChangeIndex(e.changedTouches[0].pageX-$("#imgArea").offset().left,e.changedTouches[0].pageY-$("#imgArea").offset().top,t);t==e?cellReturn(t):cellExchange(t,e),$(document).off("touchmove").off("touchend")})})}function randomArr(){imgRandArr=[].concat(imgOrigArr);for(var e=0;e<imgOrigArr.length;e++)imgRandArr.sort(function(){return.5-Math.random()})}function cellOrder(e){for(var t=0;t<e.length;t++)imgCells.eq(t).animate({left:e[t]%lever*cellWidth,top:Math.floor(e[t]/lever)*cellHeight},moveTime)}function cellChangeIndex(e,t,n){if(e<0||width<e||t<0||height<t)return n;for(var n=Math.floor(t/cellHeight),t=Math.floor(e/cellWidth),r=n*lever+t,i=0;i<imgRandArr.length&&imgRandArr[i]!=r;)i++;return i}function cellReturn(e){var t=Math.floor(imgRandArr[e]/lever),n=imgRandArr[e]%lever;imgCells.eq(e).animate({left:n*cellWidth,top:t*cellHeight},moveTime,function(){imgCells.eq(e).css("z-index","10")})}function cellExchange(t,n){var e=Math.floor(imgRandArr[t]/lever),r=imgRandArr[t]%lever,i=Math.floor(imgRandArr[n]/lever),l=imgRandArr[n]%lever;imgCells.eq(t).animate({left:l*cellWidth,top:i*cellHeight},moveTime,function(){imgCells.eq(t).css("z-index","10")}),imgCells.eq(n).css("z-index","30").animate({left:r*cellWidth,top:e*cellHeight},moveTime,function(){imgCells.eq(n).css("z-index","10");var e=imgRandArr[t];imgRandArr[t]=imgRandArr[n],imgRandArr[n]=e,$("#scroe").text("步数："+(scroe+=1)),checkPass(imgOrigArr,imgRandArr)&&passGame()})}function checkPass(e,t){return e.toString()==t.toString()}function passGame(){-1==$.inArray(presentImg,passImg)?(passImg.push(presentImg),$("#gameAnswer").text("Complete: "+scroe),passKnowledge[presentImg]="Complete: "+scroe,rebackGame(),$("#game_result span").css("background","#62baa0"),$("#game_result span").click(function(){0==s?showReward(presentImg):showback()})):($("#gameAnswer").text("Complete: "+scroe),passKnowledge[presentImg]="Complete: "+scroe,rebackGame(),console.log("info:"+passKnowledge[presentImg]),showReward(presentImg))}function showReward(e){$("#imgArea").fadeOut(),$("#game_reward").fadeIn(),$("#btn").unbind(),$("#level").unbind(),$("#game_result span").text("back"),$("#game_reward").css("background","url("+e+")"),s=1}function showback(){$("#imgArea").fadeIn(),$("#game_reward").fadeOut(),bindbtn(),bindlevel(),$("#game_result span").text("show"),s=0}
var count=0,limit=0;function preperforM(){var e;700<documentWidth?(limit=parseInt(documentWidth/110)+1,e=300,$("#imgArea").css("width",e)):(limit=7,e=documentHeight-270,$("#imgArea").width()>e?$("#imgArea").css("width",e):e=$("#imgArea").width()),$("#imgArea").css("height",e),$("#game_reward").css({width:e,height:e}),90<documentHeight-180-e?$("#game_c").css("height",documentHeight-180-e):$("#game_c").css("height",90)}function initclick(){$("#game_hrader").click(function(){history.go(-1)}),$("#game_footer ul").on("click","li",function(){console.log($(this).find("img")[0].src),initGame($(this).find("img")[0].src,this)})}function removeSclection(){$("#game_footer ul li").each(function(){$(this).removeClass("select")})}function changeState(e){$(e).addClass("select").siblings().removeClass("select"),$("#game_footer").animate({scrollLeft:$(e).offset().left-$("#game_footer").offset().left+$("#game_footer").scrollLeft()})}$(document).ready(function(){preperforM(),initGame($("#img_list").find("img")[0].src),initclick()});